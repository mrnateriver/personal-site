---
import type { JSX } from 'astro/jsx-runtime';

export type Props<AsElem extends keyof JSX.IntrinsicElements> = JSX.IntrinsicElements[AsElem] & {
  class?: string;
  caption?: string;
  fullWindowControls?: boolean;
  closeButtonHref?: string;
  canvasBackground?: boolean;
  iconSrc?: string;
  as?: AsElem;
};

const {
  class: className,
  caption,
  fullWindowControls = false,
  canvasBackground = false,
  closeButtonHref,
  iconSrc,
  as: Container = 'div',
  ...htmlProps
} = Astro.props;
---

<Container class={`win98-window ${className ?? ''}`} {...htmlProps} title={htmlProps.title ?? caption}>
  {
    caption && (
      <div class="win98-window-caption" aria-hidden={true}>
        {iconSrc && <img class="win98-window-caption-icon" src={iconSrc} alt="" aria-hidden={true} />}
        <span class="win98-window-caption-label">{caption}</span>
        {fullWindowControls && <span class="win98-window-caption-button win98-window-caption-button-minimize" />}
        {fullWindowControls && <span class="win98-window-caption-button win98-window-caption-button-expand" />}
        {closeButtonHref && (
          <a href={closeButtonHref} class="win98-window-caption-button win98-window-caption-button-close" />
        )}
        {!closeButtonHref && <span class="win98-window-caption-button win98-window-caption-button-close" />}
      </div>
    )
  }
  <div class={`win98-window-content ${canvasBackground ? 'win98-window-content-white' : ''}`}>
    <slot />
  </div>
</Container>

<style lang="scss">
  .win98-window {
    --win98-caption-icon-size: 16px;
    --win98-caption-height: 25px;
    --win98-caption-button-color: #c1c1c1;
    --win98-caption-button-offset: 4px;
    --win98-caption-button-size: calc(var(--win98-caption-height) - var(--win98-caption-button-offset) * 2);
    --win98-background: #c0c0c0;
    --win98-background-dark: #2a2a2a;
    --win98-title-start: #000281;
    --win98-title-end: #0f80ce;
    --win98-border-light: #dfdfdf;
    --win98-border-dark: #434343;
    --win98-border-width: 2px;

    display: flex;
    flex-flow: column nowrap;
    line-height: 1;
    box-sizing: border-box;
    background: var(--win98-background);

    @media (prefers-color-scheme: dark) {
      --win98-border-light: #4a4a4a;
      --win98-border-dark: #171717;
      --win98-title-start: #000149;
      --win98-title-end: #000013;
      background: var(--win98-background-dark);
    }

    border-top: var(--win98-border-width) solid var(--win98-border-light);
    border-left: var(--win98-border-width) solid var(--win98-border-light);
    border-bottom: var(--win98-border-width) solid var(--win98-border-dark);
    border-right: var(--win98-border-width) solid var(--win98-border-dark);

    &-caption {
      font-family: var(--font-family-decoration);
      margin: 0;
    }

    &-caption {
      color: white;
      background: linear-gradient(to right, var(--win98-title-start), var(--win98-title-end));
      padding: var(--win98-caption-button-offset) var(--win98-caption-button-offset) var(--win98-caption-button-offset)
        var(--padding-sm);
      display: flex;
      align-items: center;
      justify-content: flex-start;

      &-icon {
        width: var(--win98-caption-icon-size);
        height: var(--win98-caption-icon-size);
        margin-right: var(--padding-sm);
      }

      &-label {
        flex: 1;
        font-size: var(--font-size-xss);
      }

      &-button {
        color: black;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
        line-height: 1;
        font-weight: bold;
        font-size: calc(var(--win98-caption-button-size) * 0.7);
        border-top: calc(var(--win98-border-width) / 2) solid var(--win98-border-light);
        border-left: calc(var(--win98-border-width) / 2) solid var(--win98-border-light);
        border-bottom: calc(var(--win98-border-width) / 2) solid var(--win98-border-dark);
        border-right: calc(var(--win98-border-width) / 2) solid var(--win98-border-dark);
        background: var(--win98-caption-button-color);
        height: var(--win98-caption-button-size);
        width: var(--win98-caption-button-size);

        &-minimize::after,
        &-expand::after {
          display: block;
          width: 8px;
          height: 6px;
        }

        &-minimize::after {
          content: '';
          border-bottom: 2pt solid black;
        }

        &-expand::after {
          content: '';
          border: 1pt solid black;
          border-top: 2pt solid black;
        }

        &-close {
          margin-left: calc(var(--win98-caption-button-offset) / 2);

          &:hover {
            text-decoration: none;
          }

          &:visited {
            color: black;
          }

          &::after {
            content: 'x';
          }
        }
      }
    }

    &-content {
      padding: var(--padding-md);
      position: relative;
      overflow: hidden;
      flex: 1;

      &-white {
        margin: calc(var(--padding-xs) / 2);
        padding: var(--padding-sm);
        background-color: var(--color-background);
        border-style: solid;
        border-width: var(--win98-border-width);

        --win98-border-style-shadow: var(--win98-border-dark);
        --win98-border-style-light: #f4f4f4;

        border-top-color: var(--win98-border-style-shadow);
        border-left-color: var(--win98-border-style-shadow);
        border-right-color: var(--win98-border-style-light);
        border-bottom-color: var(--win98-border-style-light);

        @media (prefers-color-scheme: dark) {
          --win98-border-style-light: var(--win98-border-light);
          background-color: black;
        }
      }
    }
  }
</style>
