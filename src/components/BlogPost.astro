---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';

import Win98Button from './Win98Button.astro';
import Win98Window from './Win98Window.astro';

export interface Props {
  class?: string;
  title: string;
  summary?: string;
  date: Date;
  href: string;
  image?: ImageMetadata;
  tags?: string[];
  summaryAiGenerated?: boolean;
  readTimeMinutes?: number;
  wordCount?: number;
  codeBlocksCount?: number;
  imagesCount?: number;
}

const {
  class: className,
  title,
  summary,
  date,
  href,
  image,
  tags = [],
  summaryAiGenerated: isSummaryAiGenerated = false,
  readTimeMinutes,
  wordCount,
  codeBlocksCount,
  imagesCount,
} = Astro.props;

const caption = tags.length > 0 ? tags.join(', ') : 'Article';

const formattedDate = date.toLocaleString();
const humanDate = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

const readTimeField = typeof readTimeMinutes === 'number' ? `Read time: ${readTimeMinutes} minutes` : '';
const wordCountField = typeof wordCount === 'number' ? `Words: ${wordCount}` : '';
const codeBlocksCountField = typeof codeBlocksCount === 'number' ? `Code blocks: ${codeBlocksCount}` : '';
const imagesCountField = typeof imagesCount === 'number' ? `Images: ${imagesCount}` : '';
---

<Win98Window
  class:list={['blog-post', className]}
  as="article"
  caption={`${caption} - ${humanDate}`}
  title={`${caption} - ${formattedDate}`}
  statusFields={[readTimeField, wordCountField, codeBlocksCountField, imagesCountField].filter(Boolean)}
  canvasBackground
>
  {image && <Image src={image} alt={title} class="blog-post-image" />}

  <h2 class:list={['blog-post-title', image && 'blog-post-title-image']}>{title}</h2>

  {
    summary && (
      <div class="blog-post-content">
        <p class="blog-post-content-summary">
          {summary}
          {isSummaryAiGenerated && <span class="blog-post-content-ai-disclaimer">-- summary generated by AI</span>}
        </p>
      </div>
    )
  }

  <div class="blog-post-footer">
    <Win98Button class="blog-post-footer-button" as="a" href={href}>Read more</Win98Button>
  </div>
</Win98Window>

<style lang="scss">
  .blog-post {
    &-image {
      --image-size: 200px;

      margin-right: var(--padding-lg);
      height: var(--image-size);
      width: var(--image-size);
      object-fit: cover;
      float: left;
    }

    &-title {
      -webkit-font-smoothing: initial;
      font-family: var(--font-family-content);
      font-size: 2rem;
      margin: var(--padding-sm) 0 var(--padding-lg) 0;

      &-image {
        margin-top: 0;
      }
    }

    &-content {
      -webkit-font-smoothing: initial;
      font-family: var(--font-family-content);
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      gap: var(--padding-lg);

      &-summary {
        font-size: var(--font-size-sm);
        padding-top: var(--padding-xs);
      }

      &-ai-disclaimer {
        font-size: var(--font-size-xs);
        color: var(--color-text-secondary);
      }
    }

    &-footer {
      margin-top: var(--padding-lg);
      gap: var(--padding-sm);
    }
  }
</style>
